"use client";
import type { paths } from "mtmaiapi/query_client/generated"; // generated by openapi-typescript
import createFetchClient from "openapi-fetch";
import createClient from "openapi-react-query";
import { useMemo } from "react";
import { useMtmaiV2 } from "../stores/StoreProvider";

export function useGomtmnBackendUrl() {
  const serverUrl = useMtmaiV2((x) => x.serverUrl);
  if (!serverUrl) {
    throw new Error("Server URL is not set");
  }
  return serverUrl;
}

export function useMtmClient() {
  const serverUrl = useMtmaiV2((x) => x.serverUrl);
  if (!serverUrl) {
    throw new Error("Server URL is not set");
  }
  const accessToken = useMtmaiV2((x) => x.accessToken);
  const $mtmapi = useMemo(() => {
    const fetchClient = createFetchClient<paths>({
      baseUrl: serverUrl,
      credentials: "include",
      headers: {
        ...(accessToken && { Authorization: `Bearer ${accessToken}` }),
      },
    });
    return createClient(fetchClient);
  }, [serverUrl, accessToken]);
  return $mtmapi;
}
